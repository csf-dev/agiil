<!DOCTYPE html>
<html lang="en" metal:use-macro="Views/Shared/StandardPage/macros/page">
<head>
<title metal:fill-slot="title_element"
       tal:define="ticket here/Ticket;
                   ref string:#${ticket/Reference};
                   title ticket/Title;
                   titleContent string:${ref}: $title"
       tal:content="titleContent">AB123: Ticket title</title>
<base href="../../" />
<link href="https://fonts.googleapis.com/css?family=Lato:400,400i,700,700i|Source+Code+Pro:400,700" rel="stylesheet" />
<style>
@import url('Content/Css/Reset.css');
@import url('Content/Css/StandardPage.css');
</style>
<style metal:fill-slot="extra_styles">
@import url('Content/Css/TicketDetail.css');
</style>
</head>
<body>
<section metal:fill-slot="page_content"
         class="page_content ticket_detail"
         tal:define="ticket here/Ticket">
  <header>
    <h1 tal:content="ticket/Title" class="title_content">Ticket title</h1>
    <p>
      Ticket <strong tal:content="string:#${ticket/Reference}" class="ticket_reference">AB123</strong>:
      <span class="ticket_type" tal:content="ticket/TypeName">Thing</span>.
    </p>
  </header>
  <section class="details">
    <p>
      Created by <strong tal:content="ticket/Creator" id="TicketCreatorUsername">username</strong>
      on <strong tal:content="ticket/CreationTimestamp">2001-01-01 19:21:22</strong>.
    </p>
    <p tal:condition="ticket/Sprint">
      This ticket is part of sprint
      <a href="Sprint/Index/0"
         tal:define="url string:Sprint/Index/${ticket/Sprint/Id}"
         tal:attributes="href url"><strong tal:content="ticket/Sprint/Name"
                                           class="TicketSprintName">Sprint name</strong></a>.
    </p>
    <p tal:condition="not:ticket/Sprint">
      This ticket is not part of any sprint.
    </p>
    <h2 tal:condition="ticket/HasLabels">Labels</h2>
    <ul class="ticket_labels" tal:condition="ticket/HasLabels">
      <li tal:repeat="label ticket/Labels">
        <a href="Label/Index/label+name"
           tal:define="encodedName label/UrlEncodedName;
                       url string:Label/Index/$encodedName"
           tal:attributes="href url"><span class="name" tal:content="label/Name">Label name</span></a>
      </li>
    </ul>
    <form class="open_close_ticket"
          action="OpenCloseTicket/Close/0"
          method="POST"
          tal:define="isClosed ticket/Closed;
                      openCloseAction csharp:isClosed? &quot;Reopen&quot; : &quot;Close&quot;;
                      openCloseUrl string:OpenCloseTicket/${openCloseAction}/${ticket/Id}"
          tal:attributes="action openCloseUrl">
      <fieldset>
        <div class="form_element button" tal:condition="not:isClosed">
          <p>This ticket is <span id="TicketState">open</span></p>
          <button id="CloseTicket">Close</button>
        </div>
        <div class="form_element button" tal:condition="isClosed">
          <p>This ticket is <span id="TicketState">closed</span></p>
          <button id="ReopenTicket">Re-open</button>
        </div>
      </fieldset>
    </form>
  </section>
  <section class="description">
    <h2>Description</h2>
    <div tal:content="structure ticket/HtmlDescription" class="description_content">
      Ticket description here.
    </div>
  </section>
  <section class="relationships" tal:condition="ticket/Relationships">
    <h2>Relationships</h2>
    <table class="relationship_table">
      <colgroup>
        <col class="summary">
        <col class="ticket_title">
        <col class="ticket_ref">
      </colgroup>
      <thead>
        <th>Relationship</th>
        <th>Title</th>
        <th>#</th>
      </thead>
      <tbody>
        <tr tal:repeat="relationship ticket/Relationships">
          <td tal:content="relationship/Summary">Relates to</td>
          <td tal:content="relationship/RelatedTicket/Title">This is a ticket title</td>
          <td tal:define="relatedTicket relationship/RelatedTicket">
            <a href="Ticket/1"
               tal:attributes="href string:Ticket/${relatedTicket/Id}"
               tal:content="relatedTicket/Reference">AB123</a>
          </td>
        </tr>
      </tbody>
    </table>
  </section>
  <a href="Ticket/Edit/0"
     tal:define="editUrl string:Ticket/Edit/${ticket/Id}"
     tal:attributes="href editUrl"
     id="EditTicketLink">Edit this ticket</a>
  <section class="comments">
    <header>
      <h2>Comments</h2>
    </header>
    <ol metal:use-macro="Views/Shared/Controls/Comments/macros/comment_list"
        class="comment_list">
      <li>
        <header>
          <p>
            Written by <strong>Username</strong> on
            <strong>2001-01-01 19:21:22</strong>.
          </p>
        </header>
        <div class="comment_content">Here is some comment text.
          It runs across two lines.</div>
      </li>
      <li>
        <header>
          <p>
            Written by <strong>Username</strong> on
            <strong>2001-01-01 19:21:22</strong>.
          </p>
        </header>
        <div class="comment_content">Here is some comment text.
          It runs across two lines.</div>
      </li>
    </ol>
    <h3>Add a comment</h3>
    <div metal:use-macro="Views/Shared/Controls/Comments/macros/add_a_comment">
      Add a comment control
    </div>
  </section>
</section>
</body>
</html>