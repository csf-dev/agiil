<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
    <ProjectGuid>{93B2453A-C041-4846-94F0-D0E728E23FD0}</ProjectGuid>
    <OutputType>Library</OutputType>
    <RootNamespace>Agiil.Web.Client</RootNamespace>
    <AssemblyName>Agiil.Web.Client</AssemblyName>
    <TargetFrameworkVersion>v4.7.1</TargetFrameworkVersion>
    <ReleaseVersion>v0.8.0-alpha</ReleaseVersion>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
    <OutputPath>bin</OutputPath>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
    <OutputPath>bin</OutputPath>
  </PropertyGroup>
  <ItemGroup>
    <None Include="src/**/*" />
    <None Include="buildConfigs/**/*" />
    <None Include="flow-typed/**/*" />
    <None Include="tools/**/*" />
    <None Include="BuildClientApp.targets" />
    <None Include="package.json" />
    <None Include="package-lock.json" />
  </ItemGroup>
  
  <ItemGroup>
    <Compile Include="EmptyClass.cs" />
  </ItemGroup>
  
  <Target Name="Clean_Dist">
    <Exec Command="npm run clean" />
  </Target>

  <Target Name="Build_Dev">
    <Exec Command="npm run buildDev" />
  </Target>
  
  <Target Name="Build_Prod">
    <Exec Command="npm run build" />
  </Target>

  <Target Name="Build_NPM" AfterTargets="Build">
    <CallTarget Targets="Clean_Dist" />
    <CallTarget Targets="Build_Dev" Condition="'$(Configuration)' == 'Debug'" />
    <CallTarget Targets="Build_Prod" Condition="'$(Configuration)' == 'Release'" />
  </Target>
  
  <Target Name="CopyToWebApp" AfterTargets="Build_NPM">
    <ItemGroup>
      <BundlesSrc Include="dist\Content\bundles\**\*" />
      <HtmlSrc Include="dist\*.html" />
    </ItemGroup>
    <PropertyGroup>
      <BundlesDest>..\Agiil.Web\Content\bundles</BundlesDest>
      <HtmlDest>..\Agiil.Web\Views</HtmlDest>
    </PropertyGroup>
    <ItemGroup>
      <HtmlToDelete Include="$(HtmlDest)\**\*.assets.html" />
    </ItemGroup>
    <Delete Files="@(HtmlToDelete)" />
    <RemoveDir Directories="$(BundlesDest)" />
    <Copy SourceFiles="@(BundlesSrc)" DestinationFolder="$(BundlesDest)\" />
  </Target>

  <Target Name="CopyAssetsHtml" Inputs="@(HtmlSrc)" Outputs="%(HtmlSrc.Filename)" AfterTargets="CopyToWebApp">
    <PropertyGroup>
      <NewFilename>@(HtmlSrc-&gt;'%(Filename)'-&gt;Replace('.','\')).assets.html</NewFilename>
    </PropertyGroup>
    <Copy SourceFiles="@(HtmlSrc)" DestinationFiles="$(HtmlDest)\$(NewFilename)" />
  </Target>
  
  <Import Project="$(MSBuildBinPath)\Microsoft.CSharp.targets" />
  <Import Project="..\..\packages\MSBuildTasks.1.5.0.235\build\MSBuildTasks.targets" Condition="Exists('..\..\packages\MSBuildTasks.1.5.0.235\build\MSBuildTasks.targets')" />
</Project>